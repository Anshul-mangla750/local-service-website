<%- include('../partials/header', { title: 'Dashboard Home' }) %>

<div class="dashboard-header">
  <h1><i class="fas fa-tachometer-alt me-3"></i>Provider Dashboard Overview</h1>
  <p>Welcome back! Here's a quick overview of your service business performance.</p>
</div>

<div class="row g-4 mb-5">
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--primary-gradient) !important; color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-calendar-check fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= newBookings.length %></h2>
        <h6 class="mb-0 opacity-90">New Bookings</h6>
        <small class="opacity-75">This month</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--success-gradient) !important; color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-check-circle fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= completedCount %></h2>
        <h6 class="mb-0 opacity-90">Completed Jobs</h6>
        <small class="opacity-75">Total completed</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--warning-gradient) !important; color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-rupee-sign fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold">₹<%= revenue.toFixed(2) %></h2>
        <h6 class="mb-0 opacity-90">Total Revenue</h6>
        <small class="opacity-75">All time earnings</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--secondary-gradient) !important; color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-star fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= (Math.random() * 2 + 3).toFixed(1) %></h2>
        <h6 class="mb-0 opacity-90">Average Rating</h6>
        <small class="opacity-75">Customer feedback</small>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-white border-0 py-4">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <h5 class="mb-1 fw-bold text-dark"><i class="fas fa-list me-2 text-primary"></i>Recent New Bookings</h5>
            <p class="text-muted mb-0 small">Latest booking requests from customers</p>
          </div>
          <a href="/dashboard/bookings" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-arrow-right me-1"></i>View All
          </a>
        </div>
      </div>
      <div class="card-body">
        <% if (newBookings.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="border-0 fw-semibold"><i class="fas fa-tools me-2 text-muted"></i>Service</th>
                  <th class="border-0 fw-semibold"><i class="fas fa-user me-2 text-muted"></i>Client</th>
                  <th class="border-0 fw-semibold"><i class="fas fa-calendar me-2 text-muted"></i>Date</th>
                  <th class="border-0 fw-semibold"><i class="fas fa-info-circle me-2 text-muted"></i>Status</th>
                  <th class="border-0 fw-semibold">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% newBookings.slice(0, 5).forEach(b => { %>
                  <tr class="align-middle">
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                          <i class="fas fa-tools text-primary"></i>
                        </div>
                        <div>
                          <div class="fw-semibold"><%= b.serviceId.title %></div>
                          <small class="text-muted">Service ID: <%= b._id.toString().slice(-6) %></small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="bg-success bg-opacity-10 rounded-circle p-2 me-3">
                          <i class="fas fa-user text-success"></i>
                        </div>
                        <div>
                          <div class="fw-semibold"><%= b.userId.username %></div>
                          <small class="text-muted"><%= b.userId.email %></small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="fw-semibold"><%= new Date(b.date).toLocaleDateString() %></div>
                      <small class="text-muted"><%= b.time %></small>
                    </td>
                    <td>
                      <span class="badge bg-warning text-dark px-3 py-2">
                        <i class="fas fa-clock me-1"></i><%= b.status %>
                      </span>
                    </td>
                    <td>
                      <div class="btn-group" role="group">
                        <button class="btn btn-outline-success btn-sm" title="Accept">
                          <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" title="Reject">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="text-center py-5">
            <div class="mb-4">
              <i class="fas fa-calendar-times fa-4x text-muted opacity-50"></i>
            </div>
            <h5 class="text-muted mb-2">No New Bookings</h5>
            <p class="text-muted mb-4">You don't have any new booking requests at the moment.</p>
            <a href="/services" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>Browse Services
            </a>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-chart-line me-2 text-success"></i>Quick Stats</h5>
      </div>
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <div class="text-muted small">This Month</div>
            <div class="fw-bold fs-5">₹<%= (revenue * 0.3).toFixed(2) %></div>
          </div>
          <div class="text-success">
            <i class="fas fa-arrow-up fa-lg"></i>
          </div>
        </div>
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <div class="text-muted small">Active Services</div>
            <div class="fw-bold fs-5"><%= Math.floor(Math.random() * 10) + 1 %></div>
          </div>
          <div class="text-primary">
            <i class="fas fa-tools fa-lg"></i>
          </div>
        </div>
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="text-muted small">Response Rate</div>
            <div class="fw-bold fs-5">98%</div>
          </div>
          <div class="text-warning">
            <i class="fas fa-reply fa-lg"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-lightbulb me-2 text-warning"></i>Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="/services/new" class="btn btn-primary d-flex align-items-center justify-content-center">
            <i class="fas fa-plus me-2"></i>Add New Service
          </a>
          <a href="/dashboard/bookings" class="btn btn-outline-primary d-flex align-items-center justify-content-center">
            <i class="fas fa-calendar-check me-2"></i>Manage Bookings
          </a>
          <a href="/dashboard/earnings" class="btn btn-outline-success d-flex align-items-center justify-content-center">
            <i class="fas fa-chart-line me-2"></i>View Earnings
          </a>
          <a href="/dashboard/settings" class="btn btn-outline-secondary d-flex align-items-center justify-content-center">
            <i class="fas fa-cog me-2"></i>Update Profile
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
