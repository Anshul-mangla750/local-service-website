<%- include('../partials/header', { title: 'My Services' }) %>

<div class="dashboard-header">
  <h1><i class="fas fa-tools me-3"></i>My Services</h1>
  <p>Manage your service offerings, update details, and track performance.</p>
</div>

<div class="row g-4 mb-4">
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--primary-gradient); color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-tools fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= services.length %></h2>
        <h6 class="mb-0 opacity-90">Total Services</h6>
        <small class="opacity-75">Active listings</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--success-gradient); color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-eye fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= services.reduce((sum, s) => sum + (s.views || 0), 0) %></h2>
        <h6 class="mb-0 opacity-90">Total Views</h6>
        <small class="opacity-75">Profile visits</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--warning-gradient); color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-star fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold"><%= (services.reduce((sum, s) => sum + (s.rating || 0), 0) / Math.max(services.length, 1)).toFixed(1) %></h2>
        <h6 class="mb-0 opacity-90">Avg Rating</h6>
        <small class="opacity-75">Customer feedback</small>
      </div>
    </div>
  </div>
  <div class="col-lg-3 col-md-6">
    <div class="card h-100 border-0 shadow-sm" style="background: var(--secondary-gradient); color: white;">
      <div class="card-body text-center">
        <div class="mb-3">
          <i class="fas fa-rupee-sign fa-3x opacity-75"></i>
        </div>
        <h2 class="mb-2 fw-bold">₹<%= services.reduce((sum, s) => sum + s.price, 0) %></h2>
        <h6 class="mb-0 opacity-90">Total Value</h6>
        <small class="opacity-75">Service portfolio</small>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <h5 class="mb-1 fw-bold text-dark">Service Listings</h5>
        <p class="text-muted mb-0 small">Manage and monitor your service offerings</p>
      </div>
      <a href="/services/new" class="btn btn-primary d-flex align-items-center gap-2">
        <i class="fas fa-plus"></i>
        <span>Add New Service</span>
      </a>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <% if (services.length > 0) { %>
      <div class="row g-4" id="servicesGrid">
        <% services.forEach(service => { %>
          <div class="col-xl-4 col-lg-6 col-md-6 service-card">
            <div class="card h-100 border-0 shadow-sm hover-lift">
              <div class="card-header bg-white border-0 p-0">
                <div class="position-relative">
                  <% if (service.image && service.image.url) { %>
                    <img src="<%= service.image.url %>" alt="<%= service.title %>" class="card-img-top rounded-top" style="height: 200px; object-fit: cover;">
                  <% } else { %>
                    <div class="bg-primary bg-opacity-10 d-flex align-items-center justify-content-center rounded-top" style="height: 200px;">
                      <i class="fas fa-image fa-3x text-primary opacity-50"></i>
                    </div>
                  <% } %>
                  <div class="position-absolute top-0 end-0 m-3">
                    <span class="badge bg-primary px-3 py-2">
                      <i class="fas fa-tag me-1"></i><%= service.category %>
                    </span>
                  </div>
                </div>
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-dark mb-2"><%= service.title %></h5>
                <p class="card-text text-muted small mb-3 flex-grow-1">
                  <%= service.description.length > 100 ? service.description.substring(0, 100) + '...' : service.description %>
                </p>
                <div class="row g-2 mb-3">
                  <div class="col-6">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-rupee-sign text-success me-2"></i>
                      <span class="fw-bold text-success">₹<%= service.price %></span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-map-marker-alt text-danger me-2"></i>
                      <small class="text-muted"><%= service.location %></small>
                    </div>
                  </div>
                </div>
                <div class="row g-2 mb-3">
                  <div class="col-6">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-eye text-info me-2"></i>
                      <small class="text-muted"><%= service.views || 0 %> views</small>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-star text-warning me-2"></i>
                      <small class="text-muted"><%= (service.rating || 0).toFixed(1) %></small>
                    </div>
                  </div>
                </div>
                <div class="d-flex gap-2 mt-auto">
                  <a href="/services/<%= service._id %>/edit" class="btn btn-outline-primary btn-sm flex-fill">
                    <i class="fas fa-edit me-1"></i>Edit
                  </a>
                  <a href="/services/<%= service._id %>" class="btn btn-outline-info btn-sm flex-fill">
                    <i class="fas fa-eye me-1"></i>View
                  </a>
                  <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteService('<%= service._id %>', '<%= service.title %>')">
                    <i class="fas fa-trash me-1"></i>Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center py-5">
          <div class="mb-4">
            <i class="fas fa-tools fa-4x text-muted opacity-50"></i>
          </div>
          <h4 class="text-muted mb-3">No Services Yet!</h4>
          <p class="text-muted mb-4">You haven't added any services yet. Start building your service portfolio to attract customers and grow your business.</p>
          <a href="/services/new" class="btn btn-primary btn-lg">
            <i class="fas fa-plus me-2"></i>Add Your First Service
          </a>
        </div>
      </div>
    <% } %>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold text-danger" id="deleteModalLabel">
          <i class="fas fa-exclamation-triangle me-2"></i>Delete Service
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Are you sure you want to delete "<span id="serviceTitle"></span>"? This action cannot be undone.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form id="deleteForm" method="POST" class="d-inline">
          <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash me-1"></i>Delete Service
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.hover-lift {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.service-card {
  display: none; /* Initially hide for animation */
  animation: fadeInUp 0.6s ease forwards;
}

.service-card:nth-child(1) { animation-delay: 0.1s; }
.service-card:nth-child(2) { animation-delay: 0.2s; }
.service-card:nth-child(3) { animation-delay: 0.3s; }
.service-card:nth-child(4) { animation-delay: 0.4s; }
.service-card:nth-child(5) { animation-delay: 0.5s; }
.service-card:nth-child(6) { animation-delay: 0.6s; }

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script>
function deleteService(serviceId, serviceTitle) {
  document.getElementById('serviceTitle').textContent = serviceTitle;
  document.getElementById('deleteForm').action = `/services/${serviceId}?_method=DELETE`;
  new bootstrap.Modal(document.getElementById('deleteModal')).show();
}

document.addEventListener('DOMContentLoaded', function() {
  // Show service cards with animation
  const serviceCards = document.querySelectorAll('.service-card');
  serviceCards.forEach(card => {
    card.style.display = 'block';
  });
});
</script>

<%- include('../partials/footer') %>
