<%- include('../partials/header', { title: 'Settings' }) %>

<div class="dashboard-header">
  <h1><i class="fas fa-cog me-3"></i>Account Settings</h1>
  <p>Manage your profile information, security settings, and account preferences.</p>
</div>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-user me-2 text-primary"></i>Profile Information</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="/dashboard/settings?_method=PUT" class="needs-validation" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="username" class="form-label fw-semibold">Username</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
                <input type="text" class="form-control" id="username" name="username" value="<%= user.username %>" required>
                <div class="invalid-feedback">Please provide a valid username.</div>
              </div>
            </div>
            <div class="col-md-6">
              <label for="email" class="form-label fw-semibold">Email Address</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required>
                <div class="invalid-feedback">Please provide a valid email address.</div>
              </div>
            </div>
          </div>
          <div class="row g-3 mt-1">
            <div class="col-md-6">
              <label for="contactNumber" class="form-label fw-semibold">Phone Number</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                <input type="tel" class="form-control" id="contactNumber" name="contactNumber" value="<%= user.contactNumber || '' %>" pattern="[0-9]{10}">
                <div class="invalid-feedback">Please provide a valid 10-digit phone number.</div>
              </div>
            </div>
            <div class="col-md-6">
              <label for="workingHours" class="form-label fw-semibold">Working Hours</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-clock"></i></span>
                <input type="text" class="form-control" id="workingHours" name="workingHours" value="<%= user.workingHours || '' %>" placeholder="e.g., 9 AM - 6 PM">
              </div>
            </div>
          </div>
          <div class="mt-3">
            <label for="bio" class="form-label fw-semibold">Bio</label>
            <textarea class="form-control" id="bio" name="bio" rows="4" maxlength="500" placeholder="Tell customers about yourself and your services..."><%= user.bio || '' %></textarea>
            <div class="form-text">Maximum 500 characters. This will be displayed on your profile.</div>
          </div>
          <div class="mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-save me-2"></i>Update Profile
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notification Preferences -->
    <div class="card border-0 shadow-sm mt-4">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-bell me-2 text-warning"></i>Notification Preferences</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="/dashboard/settings/notifications?_method=PUT">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="emailNotifications" name="emailNotifications" <%= user.emailNotifications ? 'checked' : '' %>>
                <label class="form-check-label fw-semibold" for="emailNotifications">
                  <i class="fas fa-envelope me-2"></i>Email Notifications
                </label>
                <div class="form-text">Receive booking updates via email</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="smsNotifications" name="smsNotifications" <%= user.smsNotifications ? 'checked' : '' %>>
                <label class="form-check-label fw-semibold" for="smsNotifications">
                  <i class="fas fa-sms me-2"></i>SMS Notifications
                </label>
                <div class="form-text">Receive booking updates via SMS</div>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <button type="submit" class="btn btn-outline-primary">
              <i class="fas fa-save me-2"></i>Save Preferences
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- Profile Summary -->
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-user-circle me-2 text-info"></i>Profile Summary</h5>
      </div>
      <div class="card-body">
        <div class="text-center mb-3">
          <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
            <i class="fas fa-user text-primary fa-2x"></i>
          </div>
        </div>
        <div class="text-center">
          <h6 class="fw-bold mb-1"><%= user.username %></h6>
          <p class="text-muted small mb-2"><%= user.email %></p>
          <span class="badge bg-primary px-3 py-2">
            <i class="fas fa-crown me-1"></i><%= user.role %>
          </span>
        </div>
        <hr>
        <div class="row text-center g-2">
          <div class="col-6">
            <div class="fw-bold fs-5 text-primary"><%= new Date(user.createdAt).getFullYear() %></div>
            <small class="text-muted">Member Since</small>
          </div>
          <div class="col-6">
            <div class="fw-bold fs-5 text-success"><%= user.role === 'provider' ? 'Active' : 'Customer' %></div>
            <small class="text-muted">Status</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Account Actions -->
    <div class="card border-0 shadow-sm mt-4">
      <div class="card-header bg-white border-0 py-4">
        <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-shield-alt me-2 text-info"></i>Account Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-3">
          <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#deactivateModal">
            <i class="fas fa-pause me-2"></i>Deactivate Account
          </button>
          <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
            <i class="fas fa-trash-alt me-2"></i>Delete Account
          </button>
        </div>
        <div class="alert alert-info mt-3" role="alert">
          <i class="fas fa-info-circle me-2"></i>
          <small>Account actions are permanent and cannot be undone.</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Deactivate Account Modal -->
<div class="modal fade" id="deactivateModal" tabindex="-1" aria-labelledby="deactivateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold text-warning" id="deactivateModalLabel">
          <i class="fas fa-pause me-2"></i>Deactivate Account
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">Are you sure you want to deactivate your account? Your profile will be hidden from customers, but you can reactivate it anytime.</p>
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-triangle me-2"></i>
          You won't receive new booking requests while your account is deactivated.
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form method="POST" action="/dashboard/settings/deactivate?_method=PUT" class="d-inline">
          <button type="submit" class="btn btn-warning">
            <i class="fas fa-pause me-1"></i>Deactivate Account
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold text-danger" id="deleteModalLabel">
          <i class="fas fa-exclamation-triangle me-2"></i>Delete Account
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">Are you sure you want to permanently delete your account? This action cannot be undone.</p>
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          All your data, services, and booking history will be permanently removed.
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="confirmDelete" required>
          <label class="form-check-label fw-semibold" for="confirmDelete">
            I understand that this action is permanent and cannot be undone.
          </label>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>
          <i class="fas fa-trash-alt me-1"></i>Delete Account Permanently
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Delete account confirmation
document.getElementById('confirmDelete').addEventListener('change', function() {
  document.getElementById('confirmDeleteBtn').disabled = !this.checked;
});

document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
  if (document.getElementById('confirmDelete').checked) {
    // Submit delete form
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/dashboard/settings/delete?_method=DELETE';
    document.body.appendChild(form);
    form.submit();
  }
});

// Form validation
(function () {
  'use strict'
  const forms = document.querySelectorAll('.needs-validation')
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
})()
</script>

<%- include('../partials/footer') %>
